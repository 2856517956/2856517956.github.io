function Index(){return this instanceof Index?void this.init():new Index}var TimeUtils=$.getTimeUtils();Index.prototype={isLoading:!1,timerVars:{count:0},init:function(){var t=this;$.h5Show({navShow:!0,downBar:!1,search:!0,downImage:!0,footerLinkShow:!0}),$.fetch(function(i){return console.log("initialState: ",i),0!=i.ret?void $.krPopupTip(i.data.msg):(t.initCardCate(i.data.block[0]),t.render(null,i),$.toTopPercent({pdBottom:"58px"},parseInt(i.pagination._offset)+parseInt(i.pagination._limit),parseInt(i.pagination._limit),parseInt(i.pagination._count)),void 0)}),$.search(".m-search-header")},initCardCate:function(t){$("#main").html(template("tpl-nav",t));var i=$("#card-cate"),e=t.scale,n=$(window).width(),a=0;5>e?a=parseInt(n/e):(a=parseInt(n/5),i.find("ul").width(a*e)),i.find("li").width(a),e>1&&this.stickUp(i),this.switchCardCate(),$(".part-area").css("min-height",$(window).height())},stickUp:function(t){var i=Math.floor(t.offset().top),e=parseInt(t.height()),n=parseInt(t.css("margin-bottom")),a=parseInt(t.next().closest("div").css("margin-top"));$(document).on("scroll",function(){var s=parseInt($(document).scrollTop());s>=i&&(t.next().closest("div").css({"margin-top":e+n+a+"px"},10),t.css("position","fixed"),t.css({top:"0px"},100,function(){}),$("header").css("visibility","hidden")),i>s&&(t.css("position","relative"),t.next().closest("div").css({"margin-top":a+"px"},10),$("header").css("visibility","visible"))})},getCurCateId:function(){var t=$("#card-cate").find(".activity").data("id");return parseInt($.trim(t))},switchCardCate:function(){var t=this,i=$("#card-cate"),e=$("#cards-area"),n=0,a=0;i.on("click","li",function(){$(this).hasClass("activity")||($(this).addClass("activity").siblings("li").removeClass("activity"),a=t.getCurCateId(),e.find(".current").removeClass("current"),e.find('[data-id="'+a+'"]').addClass("current"),t.renderCards(e.find(".current")),n=e.find(".current").offset().top,$("html, body").stop().animate({scrollTop:n-50},"500","swing",function(){}))})},renderCards:function(t){if(t||(t=$("#cards-area").find(".current")),!t||!t.hasClass("loaded")){var i=this,e=parseInt(t.attr("data-id")),n=parseInt(t.attr("data-offset")),a=parseInt(t.attr("data-limit"));i.isLoading=!0,$.krLoading(),$.krAjax("get","h5/card",{offset:n,limit:a,cate:e},function(e){return $.krLoadingClose(),i.isLoading=!1,0!=e.ret?void $.krPopupTip(e.data.msg):(i.render(t,e),void $.toTopPercent({pdBottom:"58px"},parseInt(e.pagination._offset)+parseInt(e.pagination._limit),parseInt(e.pagination._limit),parseInt(e.pagination._count)))})}},render:function(t,i){t||(t=$("#cards-area").find(".current"));var e=this,n=parseInt(t.attr("data-offset")),a=i.pagination._limit;this.processResForTimer(i),t.find(".cards-list").append(template("tpl-cards",i.data)),this.timerVars.count>0&&this.startTimerList(),n+=a,console.log(n),t.attr({"data-offset":n}),n>=parseInt(i.pagination._count)?(t.addClass("loaded"),t.find(".load-more").html("——没有更多了——"),$(window).off("scroll.loadMore")):e.addLoadMoreListen(),$("img.lazy").lazyLoad(),e.initCarousel(t),e.initEduWrap(t),e.initBubble(t)},startTimerList:function(){for(var t in this.timerVars)if(t.indexOf("timer_id")>-1){var i=this.timerVars[t];this.startTimer(i.timer_id,i.started_at,i.expired_at)}},processResForTimer:function(t){if(t.data&&t.data.block)for(var i in t.data.block){var e=t.data.block[i];if("card-flat"==e.type&&e.items&&e.items.length>0&&e.items[0].started_at&&e.items[0].expired_at&&6==e.items[0].type){var n=e.items[0].started_at,a=e.items[0].expired_at,s="timer_id"+this.timerVars.count;this.timerVars.count++,n=TimeUtils.getDateByTimeStamp(1e3*n),a=TimeUtils.getDateByTimeStamp(1e3*a);var o=new Object;o[s]={started_at:n,expired_at:a,timer_id:s},this.timerVars=$.extend(this.timerVars,o),e.items[0].timer_id=s}}},repositionTimer:function(t){var i="#"+t,e=$(i),n=e.height();e.find(".m-wrapper-top").css("height",n/2),e.find(".m-wrapper-bottom").css("top",n/2)},startTimer:function(t,i,e){var n=this;setInterval(function(){n.checkTimeStatus(t,i,e)},1e3)},checkTimeStatus:function(t,i,e){var n=TimeUtils.getTimespanInSeconds(i,TimeUtils.getCurrentTimeStamp()),a="#"+t,s=$(a);0>n?(s.find(".m-not-yet").show(),s.find(".m-on-going").hide(),this.updateCounter(t,i,e,!1)):TimeUtils.getCurrentTimeStamp()<TimeUtils.getTimeStampByDate(e)?(s.find(".m-on-going").show(),s.find(".m-not-yet").hide(),this.updateCounter(t,i,e,!0)):(s.find(".m-on-going").hide(),s.find(".m-not-yet").hide())},updateCounter:function(t,i,e,n){this.repositionTimer(t);var a=TimeUtils.getCurrentTimeStamp(),s="#"+t,o=$(s);if(n){var r=TimeUtils.getTimespanInSeconds(e,a),d=TimeUtils.getTimeFieldsObj(r,!0),m=TimeUtils.twoDigits(d.days),l=TimeUtils.twoDigits(d.hours),c=TimeUtils.twoDigits(d.minutes),p=TimeUtils.twoDigits(d.seconds);o.find(".m-on-going .days").html(m),o.find(".m-on-going .hours").html(l),o.find(".m-on-going .minutes").html(c),o.find(".m-on-going .seconds").html(p),o.find(".m-on-going").show()}else{var f=TimeUtils.getTimespanInSeconds(i,a),d=TimeUtils.getTimeFieldsObj(f,!0),m=TimeUtils.twoDigits(d.days),l=TimeUtils.twoDigits(d.hours),c=TimeUtils.twoDigits(d.minutes),p=TimeUtils.twoDigits(d.seconds);o.find(".m-not-yet .days").html(m),o.find(".m-not-yet .hours").html(l),o.find(".m-not-yet .minutes").html(c),o.find(".m-not-yet .seconds").html(p),o.find(".m-not-yet").show()}},initCarousel:function(t){var i=t.find(".m-home-banner");i.owlCarousel({slideSpeed:300,paginationSpeed:400,singleItem:!0,pagination:!0,draggable:!0});var e=t.find(".m-nav-img");e.owlCarousel({autoPlay:!1,pagination:!1,items:4,itemsDesktop:[1e3,4],itemsDesktopSmall:[600,4],itemsTablet:[320,4],itemsMobile:!1});var n=$(".m-nav-img");n.owlCarousel({autoPlay:!1,pagination:!1,items:4,itemsDesktop:[1e3,4],itemsDesktopSmall:[600,4],itemsTablet:[320,4],itemsMobile:!1}),$("img.lazy").lazyLoad(),$.screenResize(function(){$.setHeight(".m-home-banner img",0,.427),$.setHeight(".m-nav-img .item .img",0,1,$(".m-nav-img .item a"))})},initEduWrap:function(t){var i=this,e=t.find(".m-edutation-wrap");if(e.length){var n=e.find(".list-avatar-sm .item"),a=(parseInt(parseInt(e.position().top)-parseInt(e.height()/2)),n.size()),s=0;n.eq(s).addClass("active").fadeIn(),i.timer=setInterval(function(){s++,s==a-1&&(s=0),n.fadeOut("fast").removeClass("active"),n.eq(s).addClass("active").fadeIn("slow")},5e3),e.on("click",".has-url",function(){location.href=$(this).attr("data-url")})}},addLoadMoreListen:function(){var t=this;$(window).on("scroll.loadMore",function(){$(window).height()+$(document).scrollTop()>=$(document).height()&&($(this).off(),t.isLoading||t.renderCards())})},initBubble:function(){$(".m-rebate-bubble").find(".btn-close").on("click",function(){$(".m-rebate-bubble").fadeOut()})}},Object.defineProperty(Index.prototype,"constructor",{enumerable:!1,value:Index}),$(function(){new Index});